// const { response } = require("express");

var newsURL = 'http://localhost:4999/data/latestNews';
var weatherURL = 'http://localhost:4999/data/weather';

function getNewsAndWeather() {
  /*
  fetch() 
  : The fetch() method takes one mandatory argument, the path to the resource you want to fetch. 
  It returns a Promise that resolves to the Response to that request

  â— fetch() í•¨ìˆ˜ëŠ”, Promiseë¥¼ ë¦¬í„´í•©ë‹ˆë‹¤!
  â— ê·¸ë˜ì„œ fetch() í•¨ìˆ˜ ë‹¤ìŒì— .then()ì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê±°ì˜ˆìš”! 
   */

  // â— ìš°ë¦¬ëŠ” ì¼ë‹¨ ìƒˆë¡œìš´ ê°ì²´ë¥¼ í•˜ë‚˜ ë§Œë“¤ê³  -> fetch()ë¥¼ í†µí•´ì„œ í•„ìš”í•œ JSONë°ì´í„°ë¥¼ ë°›ê³  íŒŒì‹±í•´ì„œ -> í•„ìš”í•œ ë°ì´í„°ë¥¼ ë‹´ì•„ì„œ obj ê°ì²´ì— ë‹´ì•„ì„œ ë§ˆì§€ë§‰ì— ë¦¬í„´í•´ì¤„êº¼ì˜ˆìš”!
  const obj = {};

  // ê°€ì¥ ë‹¨ìˆœí•œ í˜•íƒœì˜ fetch()ëŠ” ê°€ì ¸ì˜¤ê³ ì í•˜ëŠ” ë¦¬ì†ŒìŠ¤ì˜ ê²½ë¡œ(ì˜ˆë¥¼ ë“¤ë©´ URL)ë¥¼ ë‚˜íƒ€ë‚´ëŠ” í•˜ë‚˜ì˜ ì¸ìˆ˜ë§Œ ë°›ìŠµë‹ˆë‹¤.
  // â— ì‚¬ìš©ë²•: fetch(URL) 
  return fetch(newsURL) 

  // fetch()ì˜ ì‘ë‹µì€ Response ê°ì²´ë¡œ í‘œí˜„ë˜ë©°, ì§ì ‘ JSON ì‘ë‹µ ë³¸ë¬¸ì„ ë°›ì„ ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤. 
  // ResponseëŠ” HTTP ì‘ë‹µ ì „ì²´ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê°ì²´ë¡œ, JSON ë°ì´í„°(URLì˜ ë³¸ë¬¸ ì½˜í…ì¸ )ë¥¼ ì¶”ì¶œí•˜ê¸° ìœ„í•´ì„œëŠ” json() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ì•¼ í•©ë‹ˆë‹¤. 
  // â— ê²°ë¡ ì ìœ¼ë¡œ, Promiseë¥¼ í†µí•´ resolveí•˜ì—¬ ì‘ë‹µë°›ì€ ë°ì´í„°ë¥¼ ë°”ë¡œ ì‚¬ìš©í•˜ì§€ ëª»í•˜ê³ , json()ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê°ì²´ ë°ì´í„°ë¡œ ë§Œë“¤ì–´ì¤˜ì•¼ í•©ë‹ˆë‹¤. 
  // ğŸŒ¼ì¤‘ìš”ğŸŒ¼ json()ì€ ì‘ë‹µë°›ì€ ë³¸ë¬¸ í…ìŠ¤íŠ¸ë¥¼ JSONìœ¼ë¡œ íŒŒì‹±í•œ ê²°ê³¼ë¡œ ì´í–‰í•˜ëŠ” ğŸŒ¼ë˜ ë‹¤ë¥¸ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜ğŸŒ¼í•©ë‹ˆë‹¤.    
  // â— ë”°ë¼ì„œ, json()ì€ ë˜ ë‹¤ë¥¸ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•˜ê¸° ë•Œë¬¸ì—, ì´ì–´ì„œ .then()ì„ ì‚¬ìš©í• ìˆ˜ ìˆëŠ”ê±°ì˜ˆìš”!  
  .then((response) => response.json()) // â— response.json()ì„ í•´ì£¼ë©´, JSON ë°ì´í„° -> ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì‚¬ìš©í• ìˆ˜ ìˆëŠ” ê°ì²´ ë°ì´í„°ë¡œ ë³€í™˜ë©ë‹ˆë‹¤. 
  // â— ì €ëŠ” JSON ë°ì´í„° -> ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°ì²´ ë°ì´í„°ë¡œ ë³€í™˜ëœ ë°ì´í„°ë¥¼ ê·¸ëƒ¥ êµ¬ë¶„í•˜ê¸° ì‰½ê²Œ ì´ë¦„ì„ `data1`ìœ¼ë¡œ ë”°ë¡œ ëª…ì‹œí•´ì£¼ê³  ì‚¬ìš©í–ˆì–´ìš”! 
  .then((data1) => { 
    obj['news'] = data1["data"];  // â— ì¼ë‹¨, data1ì—ì„œ í•„ìš”í•œ ë°ì´í„°ë¥¼ ë½‘ì•„ì„œ ë¨¼ì € obj ê°ì²´ì— ë‹´ì•„ì¤„ê»˜ìš”.
    // â— ê³„ì† Promise ì²´ì¸ì„ ì´ì–´ê°€ê³  ì´ë²ˆì—” weatherURLë¡œë¶€í„° ë°ì´í„°ë¥¼ ë°›ê¸° ìœ„í•´ì„œëŠ”, ì—¬ê¸°ì—ì„œ í•œë²ˆë” fetch() ì‚¬ìš©í•´ì„œ Promiseë¥¼ ë¦¬í„´í•´ì¤„êº¼ì˜ˆìš”. 
    // â— fetch() í•¨ìˆ˜ëŠ” í”„ë¡œë¯¸ìŠ¤ë¥¼ ë¦¬í„´í•˜ê¸° ë•Œë¬¸ì— .thenì„ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”.
    // â— ì—¬ê¸°ì„œë¶€í„° data2ë¥¼ ë§Œë“¤ê¸° ìœ„í•œ ìœ„í•œ ì‘ì—…ì„ ì‹œì‘í•˜ëŠ” ê±°ì£ ?
    // â— í˜„ì¬ obj = { news: data1["data"] } ì…ë‹ˆë‹¤. 
    return fetch(weatherURL)}) // 2ë²ˆì§¸ fetch() í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ì—¬ ë™ì¼í•œ ì‘ì—…ì„ ë°˜ë³µí•´ì¤ë‹ˆë‹¤. 
  .then((response) => response.json()) // JSON ë°ì´í„° íŒŒì‹± -> JS ê°ì²´ ë°ì´í„°ë¡œ ë³€í™˜í•©ë‹ˆë‹¤. 
  .then((data2) => { // data2ê°€ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤. 
    obj['weather'] = data2; // â— data2ì—ì„œ í•„ìš”í•œ ë°ì´í„°ë¥¼ ë½‘ì•„ì„œ obj ê°ì²´ì— ë‹´ì•„ì¤ë‹ˆë‹¤.
    return obj; // â— obj = { news: data1["data"], weather: data2 }ê°€ ë˜ì–´ ë¦¬í„´ë©ë‹ˆë‹¤. 
  })
} 

if (typeof window === 'undefined') {
  module.exports = {
    getNewsAndWeather
  }
}


/* 

â— data1ê³¼ data2ì˜ ëª¨ìŠµì„ í™•ì¸í•´ë³´ì„¸ìš”.

ê°ì²´  = { í‚¤ : "ë²¨ë¥˜" }
ê°ì²´ì˜ í‚¤ë¥¼í†µí•´ ë²¨ë¥˜ë¥¼ ê°–ê³  ì˜¤ë ¤ë©´? 
- ê°ì²´.í‚¤   
- ê°ì²´["í‚¤"]

// â— data1
// data1 = { data : [  {},{},{}  ]}
// data1 = { í‚¤ : [  {í‚¤:ë²¨ë¥˜,í‚¤:ë²¨ë¥˜,í‚¤:ë²¨ë¥˜}, {í‚¤:ë²¨ë¥˜,í‚¤:ë²¨ë¥˜,í‚¤:ë²¨ë¥˜}, {í‚¤:ë²¨ë¥˜,í‚¤:ë²¨ë¥˜,í‚¤:ë²¨ë¥˜} ]  }
data1 = {  "data"  :    
                              [   
                                    {"row_id":2,
                                    "title":"2021ë…„ ê²½ì œ ì„±ì¥ë¥  ì „ë§ ë°ì•„",
                                    "source":"Aì‹ ë¬¸",
                                    "timestamp":"2020/12/30"},
                                    {"row_id":3,"title":"ì½”ë¡œë‚˜19 ì¦ê°€ì¶”ì„¸ ëŒ€í­ í•˜ë½í•´",
                                    "source":"BBC",
                                    "timestamp":"2020/12/29"},
                                    {"row_id":4,"title":"ì½”ë“œìŠ¤í…Œì´ì¸  ì·¨ì—…ì—°ê³„ íŒŒíŠ¸ë„ˆì‚¬ xxxê±´ ëŒíŒŒ",
                                    "source":"ìŠ¤íƒ€íŠ¸ì—… ë‰´ìŠ¤","timestamp":"2020/12/31"}
                              ]    
}


// â— data2
// data2 = { í‚¤ : "ë²¨ë¥˜", í‚¤ : "ë²¨ë¥˜", í‚¤ : "ë²¨ë¥˜" }
data2 = { "status" :"sunny", 
          "temperature" :"28", 
          "fineDust":"good" 
        }


// â— getNewsAndWeather()í•¨ìˆ˜ëŠ” ìµœì¢…ì ìœ¼ë¡œ ì´ëŸ° ëª¨ìŠµìœ¼ë¡œ ìƒê¸´ ê°ì²´ë¥¼ ë¦¬í„´í•´ì•¼ í•©ë‹ˆë‹¤! 
//â— { news : data1['data'], weather: data2 }
{
      news: [
                  {
                    row_id: 2,
                    title: '2021ë…„ ê²½ì œ ì„±ì¥ë¥  ì „ë§ ë°ì•„',
                    source: 'Aì‹ ë¬¸',
                    timestamp: '2020/12/30',
                  },
                  {
                    row_id: 3,
                    title: 'ì½”ë¡œë‚˜19 ì¦ê°€ì¶”ì„¸ ëŒ€í­ í•˜ë½í•´',
                    source: 'BBC',
                    timestamp: '2020/12/29',
                  },
                  {
                    row_id: 4,
                    title: 'ì½”ë“œìŠ¤í…Œì´ì¸  ì·¨ì—…ì—°ê³„ íŒŒíŠ¸ë„ˆì‚¬ xxxê±´ ëŒíŒŒ',
                    source: 'ìŠ¤íƒ€íŠ¸ì—… ë‰´ìŠ¤',
                    timestamp: '2020/12/31',
                  },
            ],
      weather: { status: 'sunny', temperature: '28', fineDust: 'good' },
    };

  */